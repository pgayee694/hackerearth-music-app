(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{116:function(e,t,n){e.exports={tagLine:"LandingPage_tagLine__1o3Bc"}},118:function(e,t,n){e.exports={overlay:"DeviceSelect_overlay__1gwlN"}},120:function(e,t,n){e.exports={overlay:"LocationPrompt_overlay__2tSHp"}},121:function(e,t,n){e.exports={header:"Header_header__1eWT5",gradient:"Header_gradient__3q6Vw"}},145:function(e,t,n){},146:function(e,t,n){},163:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),i=n(48),r=n.n(i),o=n(192),s=(n(145),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function l(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var u,d=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,198)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,i=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),i(e),r(e)}))},j=(n(146),n(174)),b=n(193),h=n(97),p=n(16),O=n(176),g=n(177),f=n(178),v=n(179),y=n(130),S=n(196),x=n(12),k=n(30);!function(e){e.GetStartedClicked="client/get-started-click",e.DevicesFetched="client/devices-fetched",e.DeviceSelected="client/device-selected",e.LocationApproved="client/location-approved",e.LocationDenied="client/location-denied",e.ClientIdRequested="client/id-requested",e.ClientIdRequestSucceeded="client/id-request-succeeded",e.ClientIdRequestFailed="client/id-request-failed",e.ClientAuthorized="client/authorized",e.StartPlayback="player/start-playback",e.QueueRequestSucceeded="player/queue-request-succeeded",e.QueueRequestFailed="player/queue-request-failed",e.QueueMoreSongs="player/queue-more-songs",e.SongFinished="player/song-finished"}(u||(u={}));var C=function(){return function(e){return function(t){return{type:e,payload:t}}}},m=function e(){Object(k.a)(this,e)};function P(e){return{createPropSelector:function(t){return function(n){return n[e][t]}}}}m.getStartedClicked=C()(u.GetStartedClicked),m.devicesFetched=C()(u.DevicesFetched),m.deviceSelected=C()(u.DeviceSelected),m.locationApproved=C()(u.LocationApproved),m.locationDenied=C()(u.LocationDenied),m.clientIdRequested=C()(u.ClientIdRequested),m.clientIdRequestSucceeded=C()(u.ClientIdRequestSucceeded),m.clientIdRequestFailed=C()(u.ClientIdRequestFailed),m.clientAuthorized=C()(u.ClientAuthorized),m.startPlayback=C()(u.StartPlayback),m.queueRequestSucceeded=C()(u.QueueRequestSucceeded),m.queueRequestFailed=C()(u.QueueRequestFailed),m.queueSongs=C()(u.QueueMoreSongs),m.songFinished=C()(u.SongFinished);var w=n(173),I=P("client").createPropSelector,q=function e(){Object(k.a)(this,e)};q.getAuth=I("auth"),q.getClientId=I("clientId"),q.isFetchingClientId=I("isFetchingClientId"),q.getDevices=I("devices"),q.getSelectedDeviceId=I("selectedDeviceId"),q.getLocation=I("location"),q.hasStartedPlayback=I("hasStartedPlayback"),q.songLengths=I("songLengths"),q.isQueuingSongs=I("isQueuingSongs"),q.isLoggedIn=Object(w.a)(q.getAuth,(function(e){return e&&Date.now()<e.timestamp+1e3*e.expiresIn})),q.hasSelectedDevice=Object(w.a)(q.getDevices,q.getSelectedDeviceId,(function(e,t){return Boolean(t&&e.some((function(e){return e.id===t})))})),q.hasLocation=Object(w.a)(q.getLocation,(function(e){return Boolean(e)})),q.currSongLength=Object(w.a)(q.songLengths,(function(e){return e?e[0]:0}));var L=n(116),F=n.n(L),D=n(3);function A(){var e=Object(x.b)(),t=Object(x.c)(q.isFetchingClientId);return Object(D.jsx)(j.a,{className:"Landing",width:"100%",height:"100%",p:"2",children:Object(D.jsx)(O.a,{direction:"column",height:"100%",flexFlow:"column",children:Object(D.jsx)(g.a,{height:"100%",children:Object(D.jsxs)(b.b,{spacing:"10",p:"2",children:[Object(D.jsx)(f.a,{size:"xl",sx:{"@media (max-width: 800px)":{fontSize:"1.5rem"}},textAlign:"left",className:F.a.tagLine,children:Object(D.jsxs)(b.b,{spacing:"4",alignItems:"start",children:[Object(D.jsx)(v.a,{pr:"6",sx:{"@media (max-width: 800px)":{padding:0}},children:"A musical odyssey."}),Object(D.jsx)(v.a,{pl:"6",sx:{"@media (max-width: 800px)":{padding:0}},children:"Guided by your surroundings."})]})}),Object(D.jsx)(y.a,{"aria-label":"Get Started",onClick:function(){return e(m.getStartedClicked())},rightIcon:Object(D.jsx)(S.a,{}),isLoading:t,children:"Get Started"})]})})})})}var R=n(188),N=n(180);function _(){}var T=n(118),E=n.n(T);function U(e){var t=e.isOpen,n=Object(x.c)(q.getDevices),c=Object(x.b)();return Object(D.jsxs)(R.a,{isOpen:t,isCentered:!0,size:"lg",onClose:_,children:[Object(D.jsx)(R.f,{className:E.a.overlay}),Object(D.jsxs)(R.c,{m:"2",children:[Object(D.jsx)(R.e,{textAlign:"center",children:"Select a device"}),Object(D.jsx)(R.b,{children:Object(D.jsxs)(N.a,{spacing:"3",children:[!n.length&&Object(D.jsx)(v.a,{align:"center",children:"No devices found"}),n.map((function(e){return Object(D.jsx)(N.b,{children:Object(D.jsx)(y.a,{isFullWidth:!0,onClick:function(){return c(m.deviceSelected(e.id))},children:e.name})},e.id)}))]})}),Object(D.jsx)(R.d,{})]})]})}var z=n(194),Q=n(120),W=n.n(Q);function G(e){var t=e.isOpen;return Object(D.jsxs)(R.a,{isOpen:t,isCentered:!0,size:"md",onClose:_,children:[Object(D.jsx)(R.f,{className:W.a.overlay}),Object(D.jsxs)(R.c,{m:"2",children:[Object(D.jsx)(R.e,{textAlign:"center",children:"Waiting for a GPS signal"}),Object(D.jsx)(R.b,{textAlign:"center",children:Object(D.jsx)(z.a,{thickness:"4px",speed:"0.65s",size:"xl"})}),Object(D.jsx)(R.d,{})]})]})}var M,B=n(195),H=n(181),J=n(182),V=n(101),$=n(62);!function(e){e.OpenPlayer="player/open",e.ClosePlayer="player/close",e.PlayClicked="player/play-clicked",e.PauseClicked="player/pause-clicked",e.LikeSongClicked="player/like-song-clicked",e.NextSongClicked="player/next-song-clicked",e.PreviousSongClicked="player/previous-song-clicked",e.PlaybackStarted="player/playback-started",e.PlayerStatusUpdateSucceeded="player/player-status-update-succeeded",e.PlayerStatusUpdateFailed="player/player-status-update-failed"}(M||(M={}));var K=function(){return function(e){return function(t){return{type:e,payload:t}}}},X=function e(){Object(k.a)(this,e)};X.openPlayer=K()(M.OpenPlayer),X.closePlayer=K()(M.ClosePlayer),X.playClicked=K()(M.PlayClicked),X.pauseClicked=K()(M.PauseClicked),X.likeSongClicked=K()(M.LikeSongClicked),X.nextSongClicked=K()(M.NextSongClicked),X.previousSongClicked=K()(M.PreviousSongClicked),X.playbackStarted=K()(M.PlaybackStarted),X.playerStatusUpdateSucceeded=K()(M.PlayerStatusUpdateSucceeded),X.playerStatusUpdateFailed=K()(M.PlayerStatusUpdateFailed);var Y=P("player").createPropSelector,Z=function e(){Object(k.a)(this,e)};function ee(e){var t=e.children,n=Object(x.c)(Z.isOpen),c=Object(x.c)(Z.isPlaying),a=Object(x.b)();return Object(D.jsx)(j.a,{className:"Player",width:"100%",height:"100%",children:Object(D.jsxs)(O.a,{direction:"column",height:"100%",flexFlow:"column",children:[Object(D.jsx)(j.a,{flex:"1",overflow:"scroll",children:t}),Object(D.jsxs)(B.a,{in:n,animateOpacity:!0,unmountOnExit:!0,children:[Object(D.jsx)(H.a,{}),Object(D.jsx)(g.a,{height:"48px",margin:"24px",children:Object(D.jsxs)(b.a,{spacing:"24px",children:[Object(D.jsx)(J.a,{"aria-label":"Like Song",onClick:function(){return a(X.likeSongClicked())},children:Object(D.jsx)(V.a,{as:$.a})}),Object(D.jsx)(J.a,{"aria-label":"Previous",onClick:function(){return a(X.previousSongClicked())},children:Object(D.jsx)(V.a,{as:$.d})}),c?Object(D.jsx)(J.a,{"aria-label":"Pause",onClick:function(){return a(X.pauseClicked())},children:Object(D.jsx)(V.a,{as:$.b})}):Object(D.jsx)(J.a,{"aria-label":"Play",onClick:function(){return a(X.playClicked())},children:Object(D.jsx)(V.a,{as:$.c})}),Object(D.jsx)(J.a,{"aria-label":"Next Song",onClick:function(){return a(X.nextSongClicked())},children:Object(D.jsx)(V.a,{as:$.e})}),Object(D.jsx)(y.a,{"aria-label":"Up Next",children:"Up Next"})]})})]})]})})}function te(){var e=Object(x.c)(Z.isOpen),t=(Object(x.c)(q.getLocation),Object(x.c)(q.getAuth),Object(x.c)(q.hasSelectedDevice)),n=Object(x.c)(q.hasLocation),a=(Object(x.c)(q.getSelectedDeviceId),Object(x.c)(q.hasStartedPlayback)),i=Object(x.c)(q.songLengths),r=Object(x.c)(q.currSongLength),o=Object(x.c)(q.isQueuingSongs),s=Object(x.b)();return Object(c.useEffect)((function(){e||s(X.openPlayer())}),[s]),Object(c.useEffect)((function(){o||a||!t||s(m.startPlayback())}),[o,a,t,s]),Object(c.useEffect)((function(){i.length<=3&&a&&!o&&s(m.queueSongs())}),[i,a,o,s]),Object(c.useEffect)((function(){a&&setTimeout((function(){s(m.songFinished())}),r)}),[a,r,s]),Object(c.useEffect)((function(){a&&s(X.playbackStarted())}),[a,s]),Object(D.jsxs)(ee,{children:[Object(D.jsx)(U,{isOpen:!t}),Object(D.jsx)(G,{isOpen:t&&!n}),Object(D.jsx)(j.a,{className:"Home",width:"100%",height:"100%",p:"4"})]})}Z.isOpen=Y("isOpen"),Z.isPlaying=Y("isPlaying");var ne=n(15),ce=n(7),ae=n(6);function ie(e){var t=e.location,n=Object(x.b)(),a=Object(p.f)();return Object(c.useEffect)((function(){if(null===t||void 0===t?void 0:t.hash){var e,c=t.hash.substring(1).split("&").map((function(e){return e.split("=")})).reduce((function(e,t){var n=Object(ae.a)(t,2),c=n[0],a=n[1];return Object(ce.a)(Object(ce.a)({},e),{},Object(ne.a)({},c,a))}),{});null!=(e=c)&&"string"===typeof e.access_token&&(a.push("/"),n(m.clientAuthorized({expiresIn:Number(c.expires_in),accessToken:c.access_token,tokenType:c.token_type,timestamp:Date.now()})))}}),[]),Object(D.jsx)(j.a,{width:"100%",height:"100%",p:"2"})}var re=n(121),oe=n.n(re);function se(){return Object(D.jsx)(j.a,{p:"3",width:"100%",bg:"gray.900",children:Object(D.jsx)(f.a,{className:oe.a.header,as:"h1",size:"4xl",children:"vibe"})})}var le=n(77),ue=n(131),de=n(129),je=function(e){Object(ue.a)(n,e);var t=Object(de.a)(n);function n(){var e;Object(k.a)(this,n);for(var c=arguments.length,a=new Array(c),i=0;i<c;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).state={hasError:!1},e}return Object(le.a)(n,[{key:"render",value:function(){return this.state.hasError?Object(D.jsxs)(b.b,{children:[Object(D.jsx)(f.a,{children:Object(D.jsx)(v.a,{align:"center",children:"Something went wrong"})}),Object(D.jsx)(v.a,{align:"center",children:"An error occurred, please refresh the page."})]}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(){return{hasError:!0}}}]),n}(a.a.Component);function be(){var e=Object(x.c)(q.isLoggedIn);return Object(D.jsx)(j.a,{className:"App",width:"100%",height:"100%",children:Object(D.jsxs)(b.b,{height:"100%",children:[Object(D.jsx)(se,{}),Object(D.jsx)(je,{children:Object(D.jsx)(h.a,{basename:"/vibe",children:Object(D.jsxs)(p.c,{children:[Object(D.jsx)(p.a,{path:"/redirect",component:ie}),Object(D.jsx)(p.a,{path:"/",children:e?Object(D.jsx)(te,{}):Object(D.jsx)(A,{})})]})})})]})})}var he=n(183),pe=Object(he.a)({config:{initialColorMode:"dark"},components:{Heading:{baseStyle:{fontWeight:"bolder"}}}}),Oe=n(54),ge=n(28),fe={isFetchingClientId:!1,selectedDeviceId:null,devices:[],location:null,hasStartedPlayback:!1,songLengths:[],totalLength:0,isQueuingSongs:!1};var ve={isOpen:!1,isPlaying:!1};var ye=n(123);n(155);var Se,xe=n(189),ke=n(191),Ce=n(185),me=n(56),Pe=n(186),we=n(82);function Ie(e,t){var n="".concat(we.a.prod).concat(e);return fetch(n,t?Object(ce.a)(Object(ce.a)(Object(ce.a)({},t),void 0!==t.body&&{body:JSON.stringify(t.body)}),{},{mode:"cors",headers:{"Content-Type":"application/json"}}):t).then((function(e){return e.json()})).then((function(e){return e}))}!function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Delete="DELETE"}(Se||(Se={}));var qe=n(184);function Le(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.pipe(Object(qe.a)((function(e){return t.includes(e.type)})))}}var Fe=n(124),De=n(125),Ae=n(197);var Re=n(190);function Ne(){var e=new Date;return e.getHours()+e.getMinutes()/60}var _e=n(187),Te=n(61),Ee=Object(ke.a)((function(e){return e.pipe(Le(u.GetStartedClicked),Object(Ce.a)((function(){return Ie("/spotify/metadata")})),Object(me.a)((function(e){if(e.clientId)return m.clientIdRequestSucceeded(e.clientId);throw new Error("Missing metadata clientId")})),Object(Pe.a)((function(){return Object(Fe.a)(m.clientIdRequestFailed())})))}),(function(e){return e.pipe(Le(u.ClientAuthorized),Object(Ce.a)((function(e){return Ie("/spotify/devices?token=".concat(e.payload.accessToken))})),Object(Pe.a)((function(){return Object(Fe.a)([])})),Object(me.a)((function(e){return m.devicesFetched(e.map((function(e){return{name:e.name,id:e.id}})))})))}),(function(e){return e.pipe(Le(u.ClientIdRequestSucceeded),Object(Ae.a)((function(e){return function(e,t){var n=Object.entries(t).map((function(e){var t=Object(ae.a)(e,2),n=t[0],c=t[1];return"".concat(n,"=").concat(Array.isArray(c)?c.map(encodeURIComponent).join(","):encodeURIComponent(String(c)))})).join("&");window.location.href="".concat(e,"?").concat(n)}(we.b,{client_id:e.payload,redirect_uri:"".concat(window.location.origin,"/redirect"),response_type:"token",scope:["app-remote-control","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","user-read-playback-position"]})})),Object(Ce.a)((function(){return De.a})))}),(function(e){return e.pipe(Le(u.ClientAuthorized),Object(Ce.a)((function(){return new Promise((function(e,t){navigator.geolocation.getCurrentPosition((function(t){return e([t])}),(function(e){return t([null,e])}))}))})),Object(me.a)((function(e){var t=Object(ae.a)(e,2),n=t[0];return t[1]?m.locationDenied():m.locationApproved({lat:n.coords.latitude,lon:n.coords.longitude})})))}),(function(e,t){return e.pipe(Le(u.StartPlayback),Object(Re.a)(t),Object(Ce.a)((function(e){var t,n=Object(ae.a)(e,2),c=(n[0],n[1]);return Ie("/vibe/start",{method:Se.Post,body:{location:c.client.location,deviceId:c.client.selectedDeviceId,hour:Ne(),token:null===(t=c.client.auth)||void 0===t?void 0:t.accessToken}})})),Object(me.a)((function(e){return m.queueRequestSucceeded(e)})),Object(Pe.a)((function(){return Object(Fe.a)(m.queueRequestFailed())})))}),(function(e,t){return e.pipe(Le(u.QueueMoreSongs),Object(Re.a)(t),Object(Ce.a)((function(e){var t,n=Object(ae.a)(e,2),c=(n[0],n[1]);return Ie("/vibe/queue",{method:Se.Post,body:{location:c.client.location,deviceId:c.client.selectedDeviceId,hour:Ne(),token:null===(t=c.client.auth)||void 0===t?void 0:t.accessToken}})})),Object(me.a)((function(e){return m.queueRequestSucceeded(e)})),Object(Pe.a)((function(){return Object(Fe.a)(m.queueRequestFailed())})))}),(function(e,t){return e.pipe(Le(M.PlayClicked,M.PauseClicked,M.NextSongClicked,M.PreviousSongClicked),Object(me.a)((function(e){switch(e.type){case M.PlayClicked:return Te.PlayerStatus.Start;case M.PauseClicked:return Te.PlayerStatus.Pause;case M.NextSongClicked:return Te.PlayerStatus.Skip;case M.PreviousSongClicked:return Te.PlayerStatus.Back;default:return Te.PlayerStatus.Start}})),Object(Re.a)(t),Object(_e.a)((function(e){var t,n=Object(ae.a)(e,2),c=n[0],a=n[1];return Ie("/spotify/status",{method:Se.Post,body:{token:null===(t=a.client.auth)||void 0===t?void 0:t.accessToken,deviceId:a.client.selectedDeviceId,status:c}})})),Object(me.a)((function(){return X.playerStatusUpdateSucceeded()})),Object(Pe.a)((function(){return Object(Fe.a)(X.playerStatusUpdateFailed())})))})),Ue=Object(Oe.combineReducers)({player:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M.OpenPlayer:return Object(ce.a)(Object(ce.a)({},e),{},{isOpen:!0});case M.ClosePlayer:return Object(ce.a)(Object(ce.a)({},e),{},{isOpen:!1});case M.PlayClicked:return Object(ce.a)(Object(ce.a)({},e),{},{isPlaying:!0});case M.PauseClicked:return Object(ce.a)(Object(ce.a)({},e),{},{isPlaying:!1});case M.PlaybackStarted:return Object(ce.a)(Object(ce.a)({},e),{},{isPlaying:!0});default:return e}},client:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fe,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case u.GetStartedClicked:return Object(ce.a)(Object(ce.a)({},t),{},{isFetchingClientId:!0});case u.ClientIdRequestFailed:return Object(ce.a)(Object(ce.a)({},t),{},{isFetchingClientId:!1});case u.ClientIdRequestSucceeded:return Object(ce.a)(Object(ce.a)({},t),{},{isFetchingClientId:!1,clientId:n.payload});case u.DevicesFetched:return Object(ce.a)(Object(ce.a)({},t),{},{devices:n.payload});case u.DeviceSelected:return Object(ce.a)(Object(ce.a)({},t),{},{selectedDeviceId:n.payload});case u.LocationApproved:return Object(ce.a)(Object(ce.a)({},t),{},{location:n.payload});case u.ClientAuthorized:var c=n.payload,a=c.accessToken,i=c.tokenType,r=c.expiresIn,o=c.timestamp;return Object(ce.a)(Object(ce.a)({},t),{},{auth:{accessToken:a,tokenType:i,expiresIn:r,timestamp:o}});case u.StartPlayback:case u.QueueMoreSongs:return Object(ce.a)(Object(ce.a)({},t),{},{isQueuingSongs:!0});case u.QueueRequestSucceeded:return Object(ce.a)(Object(ce.a)({},t),{},{songLengths:n.payload.lengths,totalLength:n.payload.totalLength,hasStartedPlayback:!0,isQueuingSongs:!1});case u.SongFinished:var s=null!==(e=Object(ge.a)(t.songLengths).shift())&&void 0!==e?e:0;return Object(ce.a)(Object(ce.a)({},t),{},{songLengths:t.songLengths.slice(1),totalLength:t.totalLength-s});default:return t}}}),ze=Object(xe.a)(),Qe=Object(Oe.createStore)(Ue,Object(Oe.applyMiddleware)(ze,Object(ye.save)()));ze.run(Ee),r.a.render(Object(D.jsx)(a.a.StrictMode,{children:Object(D.jsx)(x.a,{store:Qe,children:Object(D.jsx)(o.a,{theme:pe,children:Object(D.jsx)(be,{})})})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/vibe",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/vibe","/service-worker.js");s?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var c=n.headers.get("content-type");404===n.status||null!=c&&-1===c.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):l(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):l(t,e)}))}}(),d()},82:function(e){e.exports=JSON.parse('{"b":"https://accounts.spotify.com/authorize","a":{"local":"http://localhost:3001","prod":"http://localhost:3001"}}')}},[[163,1,2]]]);
//# sourceMappingURL=main.77cc656f.chunk.js.map