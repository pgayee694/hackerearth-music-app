(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{116:function(e,t,n){e.exports={tagLine:"LandingPage_tagLine__3MpLm"}},118:function(e,t,n){e.exports={overlay:"DeviceSelect_overlay__5urU_"}},120:function(e,t,n){e.exports={overlay:"LocationPrompt_overlay__WYOYB"}},121:function(e,t,n){e.exports={header:"Header_header__3w8li",gradient:"Header_gradient__17jx-"}},145:function(e,t,n){},146:function(e,t,n){},163:function(e,t,n){"use strict";n.r(t);var c=n(0),i=n.n(c),a=n(48),r=n.n(a),o=n(192),s=(n(145),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function l(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var u,d=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,198)).then((function(t){var n=t.getCLS,c=t.getFID,i=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),c(e),i(e),a(e),r(e)}))},j=(n(146),n(174)),b=n(193),h=n(97),p=n(16),O=n(176),g=n(177),f=n(178),v=n(179),y=n(130),S=n(196),x=n(12),k=n(30);!function(e){e.GetStartedClicked="client/get-started-click",e.DevicesFetched="client/devices-fetched",e.DeviceSelected="client/device-selected",e.LocationApproved="client/location-approved",e.LocationDenied="client/location-denied",e.ClientIdRequested="client/id-requested",e.ClientIdRequestSucceeded="client/id-request-succeeded",e.ClientIdRequestFailed="client/id-request-failed",e.ClientAuthorized="client/authorized",e.StartPlayback="player/start-playback",e.QueueRequestSucceeded="player/queue-request-succeeded",e.QueueRequestFailed="player/queue-request-failed",e.QueueMoreSongs="player/queue-more-songs",e.SongFinished="player/song-finished"}(u||(u={}));var C=function(){return function(e){return function(t){return{type:e,payload:t}}}},m=function e(){Object(k.a)(this,e)};function P(e){return{createPropSelector:function(t){return function(n){return n[e][t]}}}}m.getStartedClicked=C()(u.GetStartedClicked),m.devicesFetched=C()(u.DevicesFetched),m.deviceSelected=C()(u.DeviceSelected),m.locationApproved=C()(u.LocationApproved),m.locationDenied=C()(u.LocationDenied),m.clientIdRequested=C()(u.ClientIdRequested),m.clientIdRequestSucceeded=C()(u.ClientIdRequestSucceeded),m.clientIdRequestFailed=C()(u.ClientIdRequestFailed),m.clientAuthorized=C()(u.ClientAuthorized),m.startPlayback=C()(u.StartPlayback),m.queueRequestSucceeded=C()(u.QueueRequestSucceeded),m.queueRequestFailed=C()(u.QueueRequestFailed),m.queueSongs=C()(u.QueueMoreSongs),m.songFinished=C()(u.SongFinished);var w=n(173),I=P("client").createPropSelector,L=function e(){Object(k.a)(this,e)};L.getAuth=I("auth"),L.getClientId=I("clientId"),L.isFetchingClientId=I("isFetchingClientId"),L.getDevices=I("devices"),L.getSelectedDeviceId=I("selectedDeviceId"),L.getLocation=I("location"),L.hasStartedPlayback=I("hasStartedPlayback"),L.songLengths=I("songLengths"),L.isQueuingSongs=I("isQueuingSongs"),L.isLoggedIn=Object(w.a)(L.getAuth,(function(e){return e&&Date.now()<e.timestamp+1e3*e.expiresIn})),L.hasSelectedDevice=Object(w.a)(L.getDevices,L.getSelectedDeviceId,(function(e,t){return Boolean(t&&e.some((function(e){return e.id===t})))})),L.hasLocation=Object(w.a)(L.getLocation,(function(e){return Boolean(e)})),L.currSongLength=Object(w.a)(L.songLengths,(function(e){var t;return null!==(t=e[0])&&void 0!==t?t:0}));var q=n(116),F=n.n(q),D=n(3);function A(){var e=Object(x.b)(),t=Object(x.c)(L.isFetchingClientId);return Object(D.jsx)(j.a,{className:"Landing",width:"100%",height:"100%",p:"2",children:Object(D.jsx)(O.a,{direction:"column",height:"100%",flexFlow:"column",children:Object(D.jsx)(g.a,{height:"100%",children:Object(D.jsxs)(b.b,{spacing:"10",p:"2",children:[Object(D.jsx)(f.a,{size:"xl",sx:{"@media (max-width: 800px)":{fontSize:"1.5rem"}},textAlign:"left",className:F.a.tagLine,children:Object(D.jsxs)(b.b,{spacing:"4",alignItems:"start",children:[Object(D.jsx)(v.a,{pr:"6",sx:{"@media (max-width: 800px)":{padding:0}},children:"A musical odyssey."}),Object(D.jsx)(v.a,{pl:"6",sx:{"@media (max-width: 800px)":{padding:0}},children:"Guided by your surroundings."})]})}),Object(D.jsx)(y.a,{"aria-label":"Get Started",onClick:function(){return e(m.getStartedClicked())},rightIcon:Object(D.jsx)(S.a,{}),isLoading:t,children:"Get Started"})]})})})})}var R=n(188),_=n(180);function T(){}var N=n(118),E=n.n(N);function U(e){var t=e.isOpen,n=Object(x.c)(L.getDevices),c=Object(x.b)();return Object(D.jsxs)(R.a,{isOpen:t,isCentered:!0,size:"lg",onClose:T,children:[Object(D.jsx)(R.f,{className:E.a.overlay}),Object(D.jsxs)(R.c,{m:"2",children:[Object(D.jsx)(R.e,{textAlign:"center",children:"Select a device"}),Object(D.jsx)(R.b,{children:Object(D.jsxs)(_.a,{spacing:"3",children:[!n.length&&Object(D.jsx)(v.a,{align:"center",children:"No devices found"}),n.map((function(e){return Object(D.jsx)(_.b,{children:Object(D.jsx)(y.a,{isFullWidth:!0,onClick:function(){return c(m.deviceSelected(e.id))},children:e.name})},e.id)}))]})}),Object(D.jsx)(R.d,{})]})]})}var z=n(194),Q=n(120),W=n.n(Q);function G(e){var t=e.isOpen;return Object(D.jsxs)(R.a,{isOpen:t,isCentered:!0,size:"md",onClose:T,children:[Object(D.jsx)(R.f,{className:W.a.overlay}),Object(D.jsxs)(R.c,{m:"2",children:[Object(D.jsx)(R.e,{textAlign:"center",children:"Waiting for a GPS signal"}),Object(D.jsx)(R.b,{textAlign:"center",children:Object(D.jsx)(z.a,{thickness:"4px",speed:"0.65s",size:"xl"})}),Object(D.jsx)(R.d,{})]})]})}var M,B=n(195),H=n(181),J=n(182),Y=n(101),V=n(62);!function(e){e.OpenPlayer="player/open",e.ClosePlayer="player/close",e.PlayClicked="player/play-clicked",e.PauseClicked="player/pause-clicked",e.LikeSongClicked="player/like-song-clicked",e.NextSongClicked="player/next-song-clicked",e.PreviousSongClicked="player/previous-song-clicked",e.PlaybackStarted="player/playback-started",e.PlayerStatusUpdateSucceeded="player/player-status-update-succeeded",e.PlayerStatusUpdateFailed="player/player-status-update-failed"}(M||(M={}));var $=function(){return function(e){return function(t){return{type:e,payload:t}}}},K=function e(){Object(k.a)(this,e)};K.openPlayer=$()(M.OpenPlayer),K.closePlayer=$()(M.ClosePlayer),K.playClicked=$()(M.PlayClicked),K.pauseClicked=$()(M.PauseClicked),K.likeSongClicked=$()(M.LikeSongClicked),K.nextSongClicked=$()(M.NextSongClicked),K.previousSongClicked=$()(M.PreviousSongClicked),K.playbackStarted=$()(M.PlaybackStarted),K.playerStatusUpdateSucceeded=$()(M.PlayerStatusUpdateSucceeded),K.playerStatusUpdateFailed=$()(M.PlayerStatusUpdateFailed);var X=P("player").createPropSelector,Z=function e(){Object(k.a)(this,e)};function ee(e){var t=e.children,n=Object(x.c)(Z.isOpen),c=Object(x.c)(Z.isPlaying),i=Object(x.b)();return Object(D.jsx)(j.a,{className:"Player",width:"100%",height:"100%",children:Object(D.jsxs)(O.a,{direction:"column",height:"100%",flexFlow:"column",children:[Object(D.jsx)(j.a,{flex:"1",overflow:"scroll",children:t}),Object(D.jsxs)(B.a,{in:n,animateOpacity:!0,unmountOnExit:!0,children:[Object(D.jsx)(H.a,{}),Object(D.jsx)(g.a,{height:"48px",margin:"24px",children:Object(D.jsxs)(b.a,{spacing:"24px",children:[Object(D.jsx)(J.a,{"aria-label":"Like Song",onClick:function(){return i(K.likeSongClicked())},children:Object(D.jsx)(Y.a,{as:V.a})}),Object(D.jsx)(J.a,{"aria-label":"Previous",onClick:function(){return i(K.previousSongClicked())},children:Object(D.jsx)(Y.a,{as:V.d})}),c?Object(D.jsx)(J.a,{"aria-label":"Pause",onClick:function(){return i(K.pauseClicked())},children:Object(D.jsx)(Y.a,{as:V.b})}):Object(D.jsx)(J.a,{"aria-label":"Play",onClick:function(){return i(K.playClicked())},children:Object(D.jsx)(Y.a,{as:V.c})}),Object(D.jsx)(J.a,{"aria-label":"Next Song",onClick:function(){return i(K.nextSongClicked())},children:Object(D.jsx)(Y.a,{as:V.e})}),Object(D.jsx)(y.a,{"aria-label":"Up Next",children:"Up Next"})]})})]})]})})}function te(){var e=new Date;return e.getHours()+e.getMinutes()/60}Z.isOpen=X("isOpen"),Z.isPlaying=X("isPlaying");var ne,ce=n(7),ie=n(78);function ae(e,t){var n="".concat(ie.a.prod).concat(e);return fetch(n,t?Object(ce.a)(Object(ce.a)(Object(ce.a)({},t),void 0!==t.body&&{body:JSON.stringify(t.body)}),{},{mode:"cors",headers:{"Content-Type":"application/json"}}):t).then((function(e){return e.json()})).then((function(e){return e}))}function re(){var e=Object(x.c)(Z.isOpen),t=Object(x.c)(L.getLocation),n=Object(x.c)(L.getAuth),i=Object(x.c)(L.hasSelectedDevice),a=Object(x.c)(L.hasLocation),r=Object(x.c)(L.getSelectedDeviceId),o=Object(x.c)(L.hasStartedPlayback),s=Object(x.c)(L.songLengths),l=Object(x.c)(L.currSongLength),u=Object(x.c)(L.isQueuingSongs),d=Object(x.b)();return Object(c.useEffect)((function(){e||d(K.openPlayer())}),[d]),Object(c.useEffect)((function(){u||o||!i||d(m.startPlayback())}),[u,o,i,d]),Object(c.useEffect)((function(){s.length<=3&&o&&!u&&d(m.queueSongs())}),[s,o,u,d]),Object(c.useEffect)((function(){o&&setTimeout((function(){d(m.songFinished())}),l)}),[o,l,d]),Object(c.useEffect)((function(){o&&d(K.playbackStarted())}),[o,d]),Object(D.jsxs)(ee,{children:[Object(D.jsx)(U,{isOpen:!i}),Object(D.jsx)(G,{isOpen:i&&!a}),Object(D.jsx)(j.a,{className:"Home",width:"100%",height:"100%",p:"4",children:Object(D.jsx)(y.a,{onClick:function(){return ae("/vibe",{method:ne.Post,body:{location:t,deviceId:r,hour:te(),token:null===n||void 0===n?void 0:n.accessToken}}).catch((function(){console.log("Vibe request failed")}))},children:"Test api thing"})})]})}!function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Delete="DELETE"}(ne||(ne={}));var oe=n(15),se=n(6);function le(e){var t=e.location,n=Object(x.b)(),i=Object(p.f)();return Object(c.useEffect)((function(){if(null===t||void 0===t?void 0:t.hash){var e,c=t.hash.substring(1).split("&").map((function(e){return e.split("=")})).reduce((function(e,t){var n=Object(se.a)(t,2),c=n[0],i=n[1];return Object(ce.a)(Object(ce.a)({},e),{},Object(oe.a)({},c,i))}),{});null!=(e=c)&&"string"===typeof e.access_token&&(i.push("/"),n(m.clientAuthorized({expiresIn:Number(c.expires_in),accessToken:c.access_token,tokenType:c.token_type,timestamp:Date.now()})))}}),[]),Object(D.jsx)(j.a,{width:"100%",height:"100%",p:"2"})}var ue=n(121),de=n.n(ue);function je(){return Object(D.jsx)(j.a,{p:"3",width:"100%",bg:"gray.900",children:Object(D.jsx)(f.a,{className:de.a.header,as:"h1",size:"4xl",children:"vibe"})})}var be=n(77),he=n(131),pe=n(129),Oe=function(e){Object(he.a)(n,e);var t=Object(pe.a)(n);function n(){var e;Object(k.a)(this,n);for(var c=arguments.length,i=new Array(c),a=0;a<c;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).state={hasError:!1},e}return Object(be.a)(n,[{key:"render",value:function(){return this.state.hasError?Object(D.jsxs)(b.b,{children:[Object(D.jsx)(f.a,{children:Object(D.jsx)(v.a,{align:"center",children:"Something went wrong"})}),Object(D.jsx)(v.a,{align:"center",children:"An error occurred, please refresh the page."})]}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(){return{hasError:!0}}}]),n}(i.a.Component);function ge(){var e=Object(x.c)(L.isLoggedIn);return Object(D.jsx)(j.a,{className:"App",width:"100%",height:"100%",children:Object(D.jsxs)(b.b,{height:"100%",children:[Object(D.jsx)(je,{}),Object(D.jsx)(Oe,{children:Object(D.jsx)(h.a,{children:Object(D.jsxs)(p.c,{children:[Object(D.jsx)(p.a,{path:"/redirect",component:le}),Object(D.jsx)(p.a,{path:"/",children:e?Object(D.jsx)(re,{}):Object(D.jsx)(A,{})})]})})})]})})}var fe=n(183),ve=Object(fe.a)({config:{initialColorMode:"dark"},components:{Heading:{baseStyle:{fontWeight:"bolder"}}}}),ye=n(54),Se=n(28),xe={isFetchingClientId:!1,selectedDeviceId:null,devices:[],location:null,hasStartedPlayback:!1,songLengths:[],totalLength:0,isQueuingSongs:!1};var ke={isOpen:!1,isPlaying:!1};var Ce=n(123);n(155);var me=n(189),Pe=n(191),we=n(185),Ie=n(56),Le=n(186),qe=n(184);function Fe(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.pipe(Object(qe.a)((function(e){return t.includes(e.type)})))}}var De=n(124),Ae=n(125),Re=n(197);var _e=n(190),Te=n(187),Ne=n(61),Ee=Object(Pe.a)((function(e){return e.pipe(Fe(u.GetStartedClicked),Object(we.a)((function(){return ae("/spotify/metadata")})),Object(Ie.a)((function(e){if(e.clientId)return m.clientIdRequestSucceeded(e.clientId);throw new Error("Missing metadata clientId")})),Object(Le.a)((function(){return Object(De.a)(m.clientIdRequestFailed())})))}),(function(e){return e.pipe(Fe(u.ClientAuthorized),Object(we.a)((function(e){return ae("/spotify/devices?token=".concat(e.payload.accessToken))})),Object(Le.a)((function(){return Object(De.a)([])})),Object(Ie.a)((function(e){return m.devicesFetched(e.map((function(e){return{name:e.name,id:e.id}})))})))}),(function(e){return e.pipe(Fe(u.ClientIdRequestSucceeded),Object(Re.a)((function(e){return function(e,t){var n=Object.entries(t).map((function(e){var t=Object(se.a)(e,2),n=t[0],c=t[1];return"".concat(n,"=").concat(Array.isArray(c)?c.map(encodeURIComponent).join(","):encodeURIComponent(String(c)))})).join("&");window.location.href="".concat(e,"?").concat(n)}(ie.b,{client_id:e.payload,redirect_uri:"".concat(window.location.origin,"/redirect"),response_type:"token",scope:["app-remote-control","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","user-read-playback-position"]})})),Object(we.a)((function(){return Ae.a})))}),(function(e){return e.pipe(Fe(u.ClientAuthorized),Object(we.a)((function(){return new Promise((function(e,t){navigator.geolocation.getCurrentPosition((function(t){return e([t])}),(function(e){return t([null,e])}))}))})),Object(Ie.a)((function(e){var t=Object(se.a)(e,2),n=t[0];return t[1]?m.locationDenied():m.locationApproved({lat:n.coords.latitude,lon:n.coords.longitude})})))}),(function(e,t){return e.pipe(Fe(u.StartPlayback),Object(_e.a)(t),Object(we.a)((function(e){var t,n=Object(se.a)(e,2),c=(n[0],n[1]);return ae("/vibe/start",{method:ne.Post,body:{location:c.client.location,deviceId:c.client.selectedDeviceId,hour:te(),token:null===(t=c.client.auth)||void 0===t?void 0:t.accessToken}})})),Object(Ie.a)((function(e){return m.queueRequestSucceeded(e)})),Object(Le.a)((function(){return Object(De.a)(m.queueRequestFailed())})))}),(function(e,t){return e.pipe(Fe(u.QueueMoreSongs),Object(_e.a)(t),Object(we.a)((function(e){var t,n=Object(se.a)(e,2),c=(n[0],n[1]);return ae("/vibe/queue",{method:ne.Post,body:{location:c.client.location,deviceId:c.client.selectedDeviceId,hour:te(),token:null===(t=c.client.auth)||void 0===t?void 0:t.accessToken}})})),Object(Ie.a)((function(e){return m.queueRequestSucceeded(e)})),Object(Le.a)((function(){return Object(De.a)(m.queueRequestFailed())})))}),(function(e,t){return e.pipe(Fe(M.PlayClicked,M.PauseClicked,M.NextSongClicked,M.PreviousSongClicked),Object(Ie.a)((function(e){switch(e.type){case M.PlayClicked:return Ne.PlayerStatus.Start;case M.PauseClicked:return Ne.PlayerStatus.Pause;case M.NextSongClicked:return Ne.PlayerStatus.Skip;case M.PreviousSongClicked:return Ne.PlayerStatus.Back;default:return Ne.PlayerStatus.Start}})),Object(_e.a)(t),Object(Te.a)((function(e){var t,n=Object(se.a)(e,2),c=n[0],i=n[1];return ae("/spotify/status",{method:ne.Post,body:{token:null===(t=i.client.auth)||void 0===t?void 0:t.accessToken,deviceId:i.client.selectedDeviceId,status:c}})})),Object(Ie.a)((function(){return K.playerStatusUpdateSucceeded()})),Object(Le.a)((function(){return Object(De.a)(K.playerStatusUpdateFailed())})))})),Ue=Object(ye.combineReducers)({player:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M.OpenPlayer:return Object(ce.a)(Object(ce.a)({},e),{},{isOpen:!0});case M.ClosePlayer:return Object(ce.a)(Object(ce.a)({},e),{},{isOpen:!1});case M.PlayClicked:return Object(ce.a)(Object(ce.a)({},e),{},{isPlaying:!0});case M.PauseClicked:return Object(ce.a)(Object(ce.a)({},e),{},{isPlaying:!1});case M.PlaybackStarted:return Object(ce.a)(Object(ce.a)({},e),{},{isPlaying:!0});default:return e}},client:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xe,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case u.GetStartedClicked:return Object(ce.a)(Object(ce.a)({},t),{},{isFetchingClientId:!0});case u.ClientIdRequestFailed:return Object(ce.a)(Object(ce.a)({},t),{},{isFetchingClientId:!1});case u.ClientIdRequestSucceeded:return Object(ce.a)(Object(ce.a)({},t),{},{isFetchingClientId:!1,clientId:n.payload});case u.DevicesFetched:return Object(ce.a)(Object(ce.a)({},t),{},{devices:n.payload});case u.DeviceSelected:return Object(ce.a)(Object(ce.a)({},t),{},{selectedDeviceId:n.payload});case u.LocationApproved:return Object(ce.a)(Object(ce.a)({},t),{},{location:n.payload});case u.ClientAuthorized:var c=n.payload,i=c.accessToken,a=c.tokenType,r=c.expiresIn,o=c.timestamp;return Object(ce.a)(Object(ce.a)({},t),{},{auth:{accessToken:i,tokenType:a,expiresIn:r,timestamp:o}});case u.StartPlayback:case u.QueueMoreSongs:return Object(ce.a)(Object(ce.a)({},t),{},{isQueuingSongs:!0});case u.QueueRequestSucceeded:return Object(ce.a)(Object(ce.a)({},t),{},{songLengths:n.payload.lengths,totalLength:n.payload.totalLength,hasStartedPlayback:!0,isQueuingSongs:!1});case u.SongFinished:var s=null!==(e=Object(Se.a)(t.songLengths).shift())&&void 0!==e?e:0;return Object(ce.a)(Object(ce.a)({},t),{},{songLengths:t.songLengths.slice(1),totalLength:t.totalLength-s});default:return t}}}),ze=Object(me.a)(),Qe=Object(ye.createStore)(Ue,Object(ye.applyMiddleware)(ze,Object(Ce.save)()));ze.run(Ee),r.a.render(Object(D.jsx)(i.a.StrictMode,{children:Object(D.jsx)(x.a,{store:Qe,children:Object(D.jsx)(o.a,{theme:ve,children:Object(D.jsx)(ge,{})})})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/vibe",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/vibe","/service-worker.js");s?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var c=n.headers.get("content-type");404===n.status||null!=c&&-1===c.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):l(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):l(t,e)}))}}(),d()},78:function(e){e.exports=JSON.parse('{"b":"https://accounts.spotify.com/authorize","a":{"local":"http://localhost:3001","prod":"http://localhost:3001"}}')}},[[163,1,2]]]);
//# sourceMappingURL=main.80e7b1f8.chunk.js.map